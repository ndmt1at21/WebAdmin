'use strict';

var net = require('net');

var getPort = function getPort(options) {
  return new Promise(function (resolve, reject) {
    // For backwards compatibility with number-only input
    // TODO: Remove this in the next major version
    if (typeof options === 'number') {
      options = {
        port: options
      };
    }

    var server = net.createServer();
    server.unref();
    server.on('error', reject);
    server.listen(options, function () {
      var port = server.address().port;
      server.close(function () {
        resolve(port);
      });
    });
  });
};

module.exports = function (options) {
  return options ? getPort(options)["catch"](function () {
    return getPort(0);
  }) : getPort(0);
};
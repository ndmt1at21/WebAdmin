'use strict';

var os = require('os');

var childProcess = require('child_process');

function exec(command) {
  var output = childProcess.execSync(command, {
    encoding: 'utf8'
  });
  return output;
}

var amount;
var platform = os.platform();

if (platform === 'linux') {
  var output = exec('lscpu -p | egrep -v "^#" | sort -u -t, -k 2,4 | wc -l');
  amount = parseInt(output.trim(), 10);
} else if (platform === 'darwin') {
  var _output = exec('sysctl -n hw.physicalcpu_max');

  amount = parseInt(_output.trim(), 10);
} else if (platform === 'windows') {
  var _output2 = exec('WMIC CPU Get NumberOfCores');

  amount = _output2.split(os.EOL).map(function parse(line) {
    return parseInt(line);
  }).filter(function numbers(value) {
    return !isNaN(value);
  }).reduce(function add(sum, number) {
    return sum + number;
  }, 0);
} else {
  var cores = os.cpus().filter(function (cpu, index) {
    var hasHyperthreading = cpu.model.includes('Intel');
    var isOdd = index % 2 === 1;
    return !hasHyperthreading || isOdd;
  });
  amount = cores.length;
}

module.exports = amount;
'use strict';

var _require = require('fs'),
    readdirSync = _require.readdirSync;

var _require2 = require('child_process'),
    spawnSync = _require2.spawnSync;

var path = require('path');

var benchmarks = [];

if (!!process.env.npm_config_benchmarks) {
  benchmarks = process.env.npm_config_benchmarks.split(';').map(function (item) {
    return item + '.js';
  });
} // Run each file in this directory or the list given on the command line except
// index.js as a Node.js process.


(benchmarks.length > 0 ? benchmarks : readdirSync(__dirname)).filter(function (item) {
  return item !== 'index.js' && item.match(/\.js$/);
}).map(function (item) {
  return path.join(__dirname, item);
}).forEach(function (item) {
  var child = spawnSync(process.execPath, ['--expose-gc', item], {
    stdio: 'inherit'
  });

  if (child.signal) {
    console.error("Tests aborted with ".concat(child.signal));
    process.exitCode = 1;
  } else {
    process.exitCode = child.status;
  }

  if (child.status !== 0) {
    process.exit(process.exitCode);
  }
});
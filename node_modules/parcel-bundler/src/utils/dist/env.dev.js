"use strict";

var config = require('./config');

var dotenv = require('dotenv');

var variableExpansion = require('dotenv-expand');

function loadEnv(filepath) {
  var NODE_ENV, dotenvFiles;
  return regeneratorRuntime.async(function loadEnv$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          NODE_ENV = process.env.NODE_ENV || 'development';
          dotenvFiles = [".env.".concat(NODE_ENV, ".local"), ".env.".concat(NODE_ENV), // Don't include `.env.local` for `test` environment
          // since normally you expect tests to produce the same
          // results for everyone
          NODE_ENV !== 'test' && '.env.local', '.env'].filter(Boolean);
          _context2.next = 4;
          return regeneratorRuntime.awrap(Promise.all(dotenvFiles.map(function _callee(dotenvFile) {
            var envPath, envs;
            return regeneratorRuntime.async(function _callee$(_context) {
              while (1) {
                switch (_context.prev = _context.next) {
                  case 0:
                    _context.next = 2;
                    return regeneratorRuntime.awrap(config.resolve(filepath, [dotenvFile]));

                  case 2:
                    envPath = _context.sent;

                    if (envPath) {
                      envs = dotenv.config({
                        path: envPath
                      });
                      variableExpansion(envs);
                    }

                  case 4:
                  case "end":
                    return _context.stop();
                }
              }
            });
          })));

        case 4:
        case "end":
          return _context2.stop();
      }
    }
  });
}

module.exports = loadEnv;
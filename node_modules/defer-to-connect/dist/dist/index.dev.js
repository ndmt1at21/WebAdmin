"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var tls_1 = require("tls");

var deferToConnect = function deferToConnect(socket, fn) {
  var listeners;

  if (typeof fn === 'function') {
    var connect = fn;
    listeners = {
      connect: connect
    };
  } else {
    listeners = fn;
  }

  var hasConnectListener = typeof listeners.connect === 'function';
  var hasSecureConnectListener = typeof listeners.secureConnect === 'function';
  var hasCloseListener = typeof listeners.close === 'function';

  var onConnect = function onConnect() {
    if (hasConnectListener) {
      listeners.connect();
    }

    if (socket instanceof tls_1.TLSSocket && hasSecureConnectListener) {
      if (socket.authorized) {
        listeners.secureConnect();
      } else if (!socket.authorizationError) {
        socket.once('secureConnect', listeners.secureConnect);
      }
    }

    if (hasCloseListener) {
      socket.once('close', listeners.close);
    }
  };

  if (socket.writable && !socket.connecting) {
    onConnect();
  } else if (socket.connecting) {
    socket.once('connect', onConnect);
  } else if (socket.destroyed && hasCloseListener) {
    listeners.close(socket._hadError);
  }
};

exports["default"] = deferToConnect; // For CommonJS default export support

module.exports = deferToConnect;
module.exports["default"] = deferToConnect;